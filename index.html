<!DOCTYPE html>
<html>
<head>
	<title>d3 fun</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.14.3/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.14.3/mapbox-gl.css' rel='stylesheet' />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="newscript.js"></script>
	<script src="comhealth.js"></script>
	<script src="gardens.js"></script>
</head>
<body>
	<div id="header">
		<p></p>
		<nav>
		</nav>
	</div>
	<div id="map_container">
		<div id="map">
		</div>
	</div>
	<script type="text/javascript">
	$(document).ready(function(){
		mapboxgl.accessToken = 'pk.eyJ1IjoiYXMxNzMxNzEiLCJhIjoiY2lsNDR6bWdwM3cxb3Z5bTNvbmtmeTJsbiJ9.16HxpvRVaoKgLOBG9L-Quw';

		var map = new mapboxgl.Map({
	    	container: 'map', // container id
	    	style: 'mapbox://styles/as173171/cila7x59q007a9gkklp42kdr6', //hosted style id
	   		center: [-73.977800, 40.715824], // starting position
	   		zoom: 10, // starting zoom
		});


		map.on('style.load', function(){
			map.addSource('boroughs', {
				'type': 'vector',
				'url': 'mapbox://as173171.8smtgeas'
			});

			map.addLayer({
				"id": "boroughs",
				"type": "fill",
				"source-layer": "boroughs",
				"source": "boroughs",
				"interactive": true,
				"layout": {},
				"paint": {
					"fill-color": "#2B3E42",
					"fill-opacity": 0.5,
					"fill-outline-color": "#26244d"
				}
			});

			map.addLayer({
				"id": "route-hover",
				"type": "fill",
				"source": "boroughs",
				"source-layer":"boroughs",
				"layout": {},
				"paint": {
					"fill-color": "#2B3E42",
					"fill-opacity": 0.8,
					"fill-outline-color": "#26244d"
				},
				"filter": ["==", "BoroCode", ""]
			});
			map.on('click', function(e) {
				map.featuresAt(e.point, {
					radius: 1,
					includeGeometry: true,
					layer: ['boroughs'],
				}, function (err, features) {
					if (err || !features.length) {
						return;
					}
					var feature = features[0];
					var id = feature.properties.BoroId;
					document.getElementById("map").value = id;
					console.log(document.getElementById("map").value);
					map.panTo(map.unproject(e.point));
				});
			});
			map.on("mousemove", function(e) {
				map.featuresAt(e.point, {
					radius: 5,
					layers: ["boroughs-fill"]
				}, function (err, features){
					if (!err && features.length) {
						map.setFilter("route-hover", ["==", "BoroCode", features[0].properties.BoroCode]);
					} else {
						return;
					}
				});
			});
			// disable zooming on scroll, makes it easier to navigate around the page without accidentally zooming way out or way in
			map.scrollZoom.disable();
			map.doubleClickZoom.disable();

			var popup = new mapboxgl.Popup();

			map.on('mousemove', function (e) {
				map.featuresAt(e.point, {
					radius: 1, 
					includeGeometry: true,
					layer: ['boroughs'],
				}, function (err, features) {
					if (err || !features.length) {
						popup.remove();
						return;
					}
					var feature = features[0];
					// map.unproject(e.point) translates the pixel position of the point of the mouse into lat and long
					popup.setLngLat(map.unproject(e.point))
						.setHTML(feature.properties.BoroName)
						.addTo(map);
				});
			});
		});
	});
	</script>
	<div id="locationName">
		<h2>Select a Borough</h2>
	</div>
	<div id="healthCenters">
		<div id="pie1" class="overall"></div>
		<div id="hchart" class="overall"></div>
	</div>
	<div id="communityGardens">
		<div id="gchart" class="overall"></div>
		<div id="pie2" class="overall">
			<div class="hidden_results">
				Overall, Brooklyn is just the best.
			</div>
		</div>
	</div>
	<div id="selectedBoroughs">
		<div id="graph"></div>
		<div id="tables"></div>
	</div>
	<div id="footer">
	</div>
</body>
</html>


